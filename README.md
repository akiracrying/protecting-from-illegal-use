# Защита программного обеспечения от нелегального использования
## Постановка задачи
Необходимо реализовать программу, запрашивающую пароль, а затем, используя замену инструкции, сделать так, чтобы программа, даже при вводе неправильного пароля, предоставляла доступ пользователю. Далее нужно улучшить данную программу, зашифровав пароль, используя шифрование вида пароль XOR константа, после чего нужно аналогично взломать программу.  Следом, необходимо получить файл Nag.exe, и провести операции, позволяющие устранить всплывающие окна (также называемые nag screen). Далее нужно использовать файл Guard.exe. Данный файл необходимо сделать возможным для дизассемблирования и отладки. И наконец, нужно написать программу-обфускатор для кода программы, написанного в первом пункте.   
## Теоретические исследования
**Программа дизассемблер** — это программа, преобразующая машинный код в текст программы на языке ассемблера. Примером такой программы служит программа **IDA-pro**.

С помощью данного вида программ можно, например, обходить различные nag-screen’ы, зачастую появляющиеся в платных программах. Также можно обходить проверку пароля. 

Как уже было сказано выше, дизассемблер преобразует машинный код в текст программы, на языке ассемблера. Язык ассемблера — это машинно-ориентированный язык программирования низкого уровня. Представляет собой систему обозначений, используемую для представления в удобно читаемой форме программ, записанных в машинном коде. Его команды прямо соответствуют отдельным командам машины или их последовательностям. Сам ассемблер, это лишь транслятор программы из текста на языке ассемблера, в программу на машинном языке.

Далее необходимо разъяснить, что такое регистр процессора. Регистр процессора — это сверхбыстрая память внутри процессора, предназначенная прежде всего для хранения промежуточных результатов вычисления (регистр общего назначения/регистр данных) или содержащая данные, необходимые для работы процессора — смещения базовых таблиц, уровни доступа и т. д. (_специальные регистры_). 

Существует также **регистр флагов** — специализированный регистр, отражающий текущее состояние процессора
### Основноые использованные команды ассемблера
- JZ — команда, означающая "переход, если содержимое аккумулятора равно 0". Она выполняет ветвление по адресу, если все биты аккумулятора равны "0", в противном случае выполняется следующая команда
- JNZ — аналогичная команда, которая означает "переход, если содержимое аккумулятора равно 1". Команды JZ и JNZ являются оппозитными друг другу, и заменяются на себе противоположные, в зависимости от кода программы (то есть, если программа при выполнении инструкции JZ предоставляет доступ, а в коде используется команда JNZ — то для получения доступа их нужно поменять местами, и наоборот).

### Программа для ввода пароля
В коде программы, запрашивающей пароль, было применено шифрование, то есть пароль не хранился в программе в явном виде. Для его непосредственного хэширования (то есть перевода в некий нечитаемый вид) используется логическая функция XOR, также известное как “исключающее или”.
Применяется основное свойство:
> A XOR B XOR A = B

### Упаковка EXE-файлов
Далее для выполнения поставленных задач необходимо было ознакомится с таким типом программ как упаковщики исполняемых файлов. Упаковка исполняемых файлов заключается в сжатии исполняемого файла и прикреплении к нему кода, необходимого для распаковки и выполнения содержимого файла. 

Упаковка применяется по ряду причин
- Уменьшение размера файла
-	Шифрование содержимого для предотвращения дизассемблирования 
- Упаковка с шифрованием также может использоваться при создании вирусов, чтобы зашифровать и видоизменить код вируса для затруднения его обнаружения.
> Примерами таких программ служат AS-PACK, FSG, GHF, PeCompact и многие другие. В решении поставленной задачи была использована именно PeCompact. Для определения упаковщика используются специальные утилиты, например PEiD

После распаковки дальнейший анализ программы становиться возможным; далее используются программы-отладчики — программа для автоматизации процесса отладки: поиска ошибок в других программах, ядрах операционных систем и других видах кода. В зависимости от встроенных возможностей отладчик позволяет выполнять трассировку, отслеживать, устанавливать или изменять значения переменных в процессе выполнения кода, устанавливать и удалять контрольные точки или условия остановки и так далее
> Примерами данных программ служат OllyDBG и W32Dasm.

### Обфускация 
**Обфускация** — приведение исходного текста или исполняемого кода программы к виду, сохраняющему её функциональность, но затрудняющему анализ, понимание алгоритмов работы и модификацию при декомпиляции. Типичным примером обфускации в языках программирования является таковая в языке JavaScript. Благодаря встроенной функции eval (), которая производит выполнения кода, переданного в качестве параметра, можно буквально воспроизвести огромный код, записав его в строчку. Например, простейший код вида:
```js
  <script>
    var a = 8;
    var b = 4;
    var c = a + b;
    alert(c);
  </script>
```
Может быть представлен таким образом
```js
<script>var a = 8; var b = 4; var c; eval (c = a + b, alert(c));</script>
```
Как видно, чтение программы немного усложнилось, однако функционал программы полностью сохранился. В языке СИ также возможна реализация программ-обфускаторов, благодаря добавлению в текст программы мусорных переменных и функций, удалению отступов и так далее.
## Описание решения
### Программа, запрашивающая пароль
Первоначально была написана простая программа, запрашивающая пароль (prog.c) Пароль в данном случае хранился в файле pas.txt. В представленных файлах орректным паролем является пароль “pas”. При вводе соответствующего пароля в консоль будет выведено сообщение, об успешном вводе.

Далее, исполняемый файл данной программы (prog.exe) необходимо запустить через программу-дизассемблер (в данном случае была использована программа IDA). Далее, в коде программы, представленном на языке ассемблера, находим переход вида JNZ. Заметим, что при корректном проходе инструкции JNZ, программа не пускает пользователя, и цикл while () продолжается. Следовательно, данную команду необходимо поменять на оппозитную ей JZ.

При выполнении инструкции JNZ происходит переход к функции , которая в свою очередь выводит в консоль сообщение о неверности введённого пароля, и переносит пользователя обратно к вводу (инструкция JMP). Однако при пропуске инструкции JNZ происходит выполнение инструкции JMP, которая переносит программу к функции, которая выходит из цикла, и выводит сообщение “nice!”, осведомляющие пользователя об успешном вводе пароля. Однако, при замене инструкций, данный безусловный будет выполняться во всех случаях, кроме того, когда будет введён действительно правильный пароль. 
